<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Image Carousel with Average Color Background">
    <title>The Purcell Family</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <style>
        #image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        .carousel-image {
            max-width: 100%;
            max-height: 100%;
            border: none;
            position: absolute;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .carousel-image.active {
            opacity: 1;
        }
    </style>
</head>

<body>
    <div id="image-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const imageContainer = document.getElementById('image-container');
            let currentIndex = 0;
            let images = [];
            const preloadCount = 3;
            let loadedImagesCount = 0;
            let imageUrls = [];

            // Function to shuffle array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // Function to calculate average color of the 3-pixel buffer edge of an image
            function getAverageColor(img) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                context.drawImage(img, 0, 0, img.width, img.height);
                const imageData = context.getImageData(0, 0, img.width, img.height);
                const data = imageData.data;
                let r = 0, g = 0, b = 0;
                let count = 0;

                // Top and bottom edges
                for (let x = 0; x < img.width; x++) {
                    for (let y = 0; y < 3; y++) { // Top edge
                        const index = (y * img.width + x) * 4;
                        r += data[index];
                        g += data[index + 1];
                        b += data[index + 2];
                        count++;
                    }
                    for (let y = img.height - 3; y < img.height; y++) { // Bottom edge
                        const index = (y * img.width + x) * 4;
                        r += data[index];
                        g += data[index + 1];
                        b += data[index + 2];
                        count++;
                    }
                }

                // Left and right edges
                for (let y = 3; y < img.height - 3; y++) {
                    for (let x = 0; x < 3; x++) { // Left edge
                        const index = (y * img.width + x) * 4;
                        r += data[index];
                        g += data[index + 1];
                        b += data[index + 2];
                        count++;
                    }
                    for (let x = img.width - 3; x < img.width; x++) { // Right edge
                        const index = (y * img.width + x) * 4;
                        r += data[index];
                        g += data[index + 1];
                        b += data[index + 2];
                        count++;
                    }
                }

                r = Math.floor(r / count);
                g = Math.floor(g / count);
                b = Math.floor(b / count);

                return `rgb(${r}, ${g}, ${b})`;
            }

            // Function to preload images
            function preloadImages() {
                const urlsToLoad = imageUrls.slice(loadedImagesCount, loadedImagesCount + preloadCount);
                for (let i = 0; i < urlsToLoad.length; i++) {
                    const img = new Image();
                    img.src = urlsToLoad[i];
                    img.classList.add('carousel-image');
                    img.onload = () => {
                        if (images.length === 0) {
                            img.classList.add('active');
                            document.body.style.backgroundColor = getAverageColor(img);
                        }
                    };
                    imageContainer.appendChild(img);
                    images.push(img);
                }
                loadedImagesCount += urlsToLoad.length;
            }

            // Function to start the carousel
            function startCarousel() {
                setInterval(() => {
                    images[currentIndex].classList.remove('active');
                    currentIndex = (currentIndex + 1) % images.length;
                    images[currentIndex].classList.add('active');
                    document.body.style.backgroundColor = getAverageColor(images[currentIndex]);

                    // Preload more images if needed
                    if (currentIndex === images.length - 1 && loadedImagesCount < imageUrls.length) {
                        preloadImages();
                    }
                }, 4000); // Change image every 4 seconds
            }

            // Load the JSON file containing the image URLs
            fetch("images.json")
                .then(response => response.json())
                .then(data => {
                    imageUrls = data;
                    shuffleArray(imageUrls);
                    preloadImages();
                    startCarousel();
                })
                .catch(error => console.error('Error loading JSON:', error));
        });
    </script>
</body>

</html>